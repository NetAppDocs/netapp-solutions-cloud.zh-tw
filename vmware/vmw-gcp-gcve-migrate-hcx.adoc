---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-migrate-hcx.html 
keywords: gcp, gcve, hybrid, multicloud, migrate, vmware, hcx, google, cloud, enterprise, hybrid, cloud, migration 
summary:  
---
= 使用 VMware HCX 將工作負載遷移到Google Cloud NetApp Volumes資料儲存區 - 快速入門指南
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Google Cloud VMware Engine 和 Cloud Volume Service 資料儲存最常見的用例之一是遷移 VMware 工作負載。  VMware HCX 是首選方案，它提供了各種遷移機制，可將本機虛擬機器 (VM) 及其資料移至 Cloud Volume Service NFS 資料儲存。



== 概述：使用 VMware HCX、 Google Cloud NetApp Volumes資料儲存區和 Google Cloud VMware Engine (GCVE) 遷移虛擬機

VMware HCX 主要是一個遷移平台，旨在簡化應用程式遷移、工作負載重新平衡甚至跨雲端的業務連續性。它是 Google Cloud VMware Engine Private Cloud 的一部分，提供了多種遷移工作負載的方法，並可用於災難復原 (DR) 作業。

本文檔提供了配置 Cloud Volume Service 資料儲存區的逐步指導，隨後下載、部署和配置 VMware HCX，包括其在本地和 Google Cloud VMware Engine 端的所有主要元件（包括互連、網路擴展和 WAN 最佳化），以支援各種 VM 遷移機制。


NOTE: VMware HCX 適用於任何資料儲存類型，因為遷移是在 VM 層級進行的。因此，本文檔適用於現有NetApp客戶和計畫使用 Google Cloud VMware Engine 部署 Cloud Volume Service 以實現經濟高效的 VMware 雲端部署的非NetApp客戶。

.摘要步驟
[%collapsible%open]
====
此清單提供了將虛擬機器從本機 HCX Connector 配對並遷移到 Google Cloud VMware Engine 端的 HCX Cloud Manager 所需的進階步驟：

. 透過 Google VMware Engine 入口網站準備 HCX。
. 在本機 VMware vCenter Server 中下載並部署 HCX Connector Open Virtualization Appliance (OVA) 安裝程式。
. 使用許可證金鑰啟動 HCX。
. 將本機 VMware HCX Connector 與 Google Cloud VMware Engine HCX Cloud Manager 配對。
. 設定網路設定檔、計算設定檔和服務網格。
. （可選）執行網路擴展以避免在遷移期間重新分配 IP。
. 驗證設備狀態並確保可以遷移。
. 遷移虛擬機器工作負載。


====
.先決條件
[%collapsible%open]
====
在開始之前，請確保滿足以下先決條件。有關詳細信息，請參閱 https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["關聯"^]。滿足連線等先決條件後，從 Google Cloud VMware Engine 入口網站下載 HCX 授權金鑰。下載 OVA 安裝程式後，請依照如下所述進行安裝程序。


NOTE: HCX 高級版是預設選項，VMware HCX 企業版也可透過支援票獲得，且無需額外付費即可獲得支援。參考 https://cloud.google.com/blog/products/compute/whats-new-with-google-cloud-vmware-engine["此連結"^]

* 使用現有的 Google Cloud VMware Engine 軟體定義資料中心 (SDDC) 或使用此link:vmw-gcp-gcve-setup.html["NetApp連結"^]或者這個 https://cloud.google.com/vmware-engine/docs/create-private-cloud["Google連結"^]。
* 從支援 VMware vSphere 的內部部署資料中心遷移虛擬機器和相關資料需要從資料中心到 SDDC 環境的網路連線。在遷移工作負載之前， https://cloud.google.com/vmware-engine/docs/networking/howto-connect-to-onpremises["設定 Cloud VPN 或 Cloud Interconnect 連接"^]在本地環境和對應的私有雲之間。
* 從本機 VMware vCenter Server 環境到 Google Cloud VMware Engine 私有雲的網路路徑必須支援使用 vMotion 遷移虛擬機器。
* 確保所需的 https://ports.esp.vmware.com/home/VMware-HCX["防火牆規則和連接埠"^]允許在本機 vCenter Server 和 SDDC vCenter 之間進行 vMotion 流量。
* Cloud Volume Service NFS 磁碟區應作為資料儲存安裝在 Google Cloud VMware Engine 中。請按照本文中詳細說明的步驟操作 https://cloud.google.com/vmware-engine/docs/vmware-ecosystem/howto-cloud-volumes-service-datastores["關聯"^]將 Cloud Volume Service 資料儲存附加到 Google Cloud VMware Engines 主機。


====
.進階架構
[%collapsible%open]
====
為了測試目的，用於此驗證的本地實驗室環境透過 Cloud VPN 連接，這允許本地連接到 Google Cloud VPC。

image:gcpd-hcx-001.png["該圖描述了該解決方案中使用的高階架構。"]

有關將 VMware HCX 與 Google 結合使用的更多詳細信息，請參閱 https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["VMware 連結"^]

====


== 解決方案部署

請按照一系列步驟完成此解決方案的部署：

.步驟 1：透過 Google VMware Engine 入口網站準備 HCX
[%collapsible%open]
====
當您使用 VMware Engine 設定私有雲時，HCX Cloud Manager 元件會自動安裝。若要準備網站配對，請完成以下步驟：

. 登入 Google VMware Engine 入口網站並登入 HCX Cloud Manager。
+
您可以透過點擊 HCX 版本連結登入 HCX 控制台image:gcpd-hcx-002.png["透過 GCVE 資源上的連結存取 HCX 控制台"]或點選 vSphere 管理網路標籤下的 HCX FQDN。image:gcpd-hcx-003.png["使用 FQDN 連結存取 HCX 控制台"]

. 在 HCX 雲端管理器中，前往「管理」>「系統更新」。
. 點擊*請求下載連結*並下載 OVA 檔案。image:gcpd-hcx-004.png["請求下載鏈接"]
. 將 HCX Cloud Manager 更新至 HCX Cloud Manager UI 提供的最新版本。


====
.步驟 2：在本機 vCenter Server 中部署安裝程式 OVA
[%collapsible%open]
====
若要將本機連接器連接至 Google Cloud VMware Engine 中的 HCX 管理器，請確保在本機環境中開啟了對應的防火牆連接埠。

若要在本機 vCenter Server 中下載並安裝 HCX Connector，請完成下列步驟：

. 按照上一步所述，從 Google Cloud VMware Engine 上的 HCX 控制台下載 ova。
. 下載 OVA 後，使用 *部署 OVF 範本* 選項將其部署到本機 VMware vSphere 環境。
+
image:gcpd-hcx-005.png["螢幕截圖以選擇正確的 OVA 模板。"]

. 輸入 OVA 部署所需的所有信息，按一下“下一步”，然後按一下“完成”以部署 VMware HCX 連接器 OVA。
+

NOTE: 手動啟動虛擬設備。



有關逐步說明，請參閱 https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx#prepare-for-hcx-manager-installation["Google HCX 文件"^]。

====
.步驟 3：使用許可證金鑰啟動 HCX Connector
[%collapsible%open]
====
在本機部署 VMware HCX Connector OVA 並啟動裝置後，請完成以下步驟以啟動 HCX Connector。從 Google Cloud VMware Engine 入口網站產生許可證金鑰並在 VMware HCX Manager 中啟動它。

. 在 VMware Engine 入口網站中，按一下“資源”，選擇私有雲，然後*按一下“HCX Manager 雲端版本”下的下載圖示*。image:gcpd-hcx-006.png["下載 HCX 許可證"]開啟下載的檔案並複製許可證金鑰字串。
. 登入本機 VMware HCX 管理器 `"https://hcxmanagerIP:9443"`使用管理員憑證。
+

NOTE: 使用 OVA 部署期間定義的 hcxmanagerIP 和密碼。

. 在許可中，輸入從步驟 3 複製的金鑰，然後按一下 *啟動*。
+

NOTE: 本地 HCX 連接器應該具有網路存取權限。

. 在「資料中心位置」下，提供在本機安裝 VMware HCX 管理器的最近位置。按一下“繼續”。
. 在“*系統名稱*”下，更新名稱並按一下“*繼續*”。
. 點擊“是，繼續”。
. 在「連接您的 vCenter」下，提供 vCenter Server 的完全限定網域名稱 (FQDN) 或 IP 位址以及對應的憑證，然後按一下「繼續」。
+

NOTE: 使用 FQDN 以避免日後出現連線問題。

. 在「設定 SSO/PSC」下，提供平台服務控制器 (PSC) 的 FQDN 或 IP 位址，然後按一下「繼續」。
+

NOTE: 對於嵌入式 PSC，輸入 VMware vCenter Server FQDN 或 IP 位址。

. 驗證輸入的資訊是否正確，然後按一下「*重新啟動*」。
. 服務重新啟動後，vCenter Server 在出現的頁面上顯示為綠色。  vCenter Server 和 SSO 都必須具有適當的設定參數，這些參數應與上一頁相同。
+

NOTE: 此過程大約需要 10 到 20 分鐘，以便將插件新增至 vCenter Server。

+
image:gcpd-hcx-007.png["螢幕截圖顯示了已完成的過程。"]



====
.步驟 4：將本機 VMware HCX 連接器與 Google Cloud VMware Engine HCX Cloud Manager 配對
[%collapsible%open]
====
在本機 vCenter 上部署和設定 HCX Connector 後，透過新增配對建立與 Cloud Manager 的連線。若要設定網站配對，請完成以下步驟：

. 若要在本機 vCenter 環境和 Google Cloud VMware Engine SDDC 之間建立網站對，請登入本機 vCenter Server 並造訪新的 HCX vSphere Web Client 外掛程式。
+
image:gcpd-hcx-008.png["HCX vSphere Web Client 插件的螢幕截圖。"]

. 在基礎架構下，按一下*新增網站配對*。
+

NOTE: 輸入 Google Cloud VMware Engine HCX Cloud Manager URL 或 IP 位址以及具有 Cloud-Owner-Role 權限的使用者存取私有雲的憑證。

+
image:gcpd-hcx-009.png["螢幕截圖 CloudOwner 角色的 URL 或 IP 位址和憑證。"]

. 按一下“連接”。
+

NOTE: VMware HCX Connector 必須能夠透過連接埠 443 路由至 HCX Cloud Manager IP。

. 建立配對後，新配置的網站配對可在 HCX 儀表板上取得。
+
image:gcpd-hcx-010.png["HCX 儀表板上已完成流程的螢幕截圖。"]



====
.步驟 5：設定網路設定檔、計算設定檔和服務網格
[%collapsible%open]
====
VMware HCX Interconnect 服務設備透過網際網路和與目標網站的專用連線提供複製和基於 vMotion 的遷移功能。互連提供加密、流量工程和 VM 移動性。若要建立互連服務設備，請完成以下步驟：

. 在基礎架構下，選擇*互連>多站點服務網格>計算設定檔>建立計算設定檔*。
+

NOTE: 計算設定檔定義部署參數，包括部署的設備以及 VMware 資料中心的哪些部分可供 HCX 服務存取。

+
image:gcpd-hcx-011.png["vSphere 用戶端互連頁面的螢幕截圖。"]

. 建立計算設定檔後，透過選擇「多站點服務網格」>「網路設定檔」>「建立網路設定檔」來建立網路設定檔。
+
網路設定檔定義了 HCX 用於其虛擬設備的一系列 IP 位址和網路。

+

NOTE: 此步驟需要兩個或更多 IP 位址。這些 IP 位址由管理網路指派給互連設備。

+
image:gcpd-hcx-012.png["網路概況的螢幕截圖。"]

. 此時，計算和網路設定檔已成功建立。
. 透過選擇「*Interconnect*」選項中的「*Service Mesh*」標籤來建立服務網格，並選擇本地和 GCVE SDDC 網站。
. 服務網格指定本地和遠端計算和網路設定檔對。
+

NOTE: 作為此流程的一部分，HCX 裝置在來源網站和目標網站上部署並自動配置，以建立安全的傳輸結構。

+
image:gcpd-hcx-013.png["vSphere 用戶端互連頁面上的服務網格標籤的螢幕截圖。"]

. 這是配置的最後一步。完成部署大約需要 30 分鐘。配置服務網格後，環境已準備就緒，並已成功建立 IPsec 隧道來遷移工作負載虛擬機器。
+
image:gcpd-hcx-014.png["vSphere 用戶端互連頁面上的 HCX 設備的螢幕截圖。"]



====
.步驟 6：遷移工作負載
[%collapsible%open]
====
可以使用各種 VMware HCX 遷移技術在本地和 GCVE SDDC 之間雙向遷移工作負載。可以使用多種遷移技術將虛擬機器移至 VMware HCX 啟動的實體或從中移出，例如 HCX 批量遷移、HCX vMotion、HCX 冷遷移、HCX 複製輔助 vMotion（HCX 企業版提供）和 HCX OS 輔助遷移（HCX 企業版提供）。

要了解有關各種 HCX 遷移機制的更多信息，請參閱 https://cloud.google.com/vmware-engine/docs/workloads/howto-migrate-vms-using-hcx["使用 VMware HCX 文件遷移 VMware VM"^]。

HCX-IX 設備使用行動代理服務執行 vMotion、Cold 和複製輔助 vMotion (RAV) 遷移。


NOTE: HCX-IX 設備將行動代理服務新增為 vCenter Server 中的主機物件。此物件上顯示的處理器、記憶體、儲存和網路資源並不代表託管 IX 裝置的實體虛擬機器管理程式上的實際消耗。

*HCX vMotion*

本節介紹 HCX vMotion 機制。此遷移技術使用 VMware vMotion 協定將虛擬機器遷移到 GCVE。 vMotion 遷移選項用於一次遷移單一 VM 的 VM 狀態。此遷移方法期間不會中斷服務。


NOTE: 應該實施網路擴充（針對虛擬機器所連接的連接埠群組），以便遷移虛擬機器而無需更改 IP 位址。

. 從本機 vSphere 用戶端，前往“清單”，右鍵點選要遷移的虛擬機，然後選擇“HCX 動作”>“遷移到 HCX 目標網站”。
+
image:gcpd-hcx-015.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 在遷移虛擬機器精靈中，選擇遠端站台連線（目標 GCVE）。
+
image:gcpd-hcx-016.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 更新必填欄位（叢集、儲存和目標網路），按一下驗證。
+
image:gcpd-hcx-017.png["此圖顯示輸入/輸出對話框或表示書面內容"]

. 驗證檢查完成後，按一下“Go”開始遷移。
+

NOTE: vMotion 傳輸擷取 VM 活動記憶體、其執行狀態、其 IP 位址和其 MAC 位址。有關 HCX vMotion 的要求和限制的更多信息，請參閱 https://techdocs.broadcom.com/us/en/vmware-cis/hcx/vmware-hcx/4-10/vmware-hcx-user-guide-4-10/migrating-virtual-machines-with-vmware-hcx/understanding-vmware-hcx-vmotion-and-cold-migration.html#GUID-517866F6-AF06-4EFC-8FAE-DA067418D584-en["了解 VMware HCX vMotion 和冷遷移"^]。

. 您可以從 HCX > 遷移儀表板監控 vMotion 的進度和完成情況。
+
image:gcpd-hcx-018.png["此圖顯示輸入/輸出對話框或表示書面內容"]




NOTE: 目標Google Cloud NetApp Volumes （NetApp Volumes）NFS 資料儲存應具有足夠的空間來處理遷移。

====


== 結論

無論您的目標是全雲還是混合雲，以及駐留在本地任何類型/供應商存儲上的數據，Cloud Volume Service 和 HCX 都提供了部署和遷移應用程式工作負載的絕佳選擇，同時透過使數據需求無縫連接到應用程式層來降低 TCO。無論用例如何，選擇 Google Cloud VMware Engine 以及 Cloud Volume Service 都可以快速實現雲端優勢、跨本地和多雲的一致基礎架構和操作、工作負載的雙向可移植性以及企業級容量和效能。使用 VMware vSphere Replication、VMware vMotion 甚至網路檔案複製 (NFC) 連接儲存和遷移虛擬機器所使用的流程和程式相同。



== 總結

該文件的要點包括：

* 現在您可以將 Cloud Volume Service 用作 Google Cloud VMware Engine SDDC 上的資料儲存。
* 您可以輕鬆地將資料從本地遷移到 Cloud Volume Service 資料儲存區。
* 您可以輕鬆擴大或縮小 Cloud Volume Service 資料儲存以滿足遷移活動期間的容量和效能要求。




== 參考 Google 和 VMware 的視頻

.來自Google
[%collapsible%open]
====
* link:https://www.youtube.com/watch?v=xZOtqiHY5Uw["使用 GCVE 部署 HCX 連接器"]
* link:https://youtu.be/2ObPvekMlqA["使用 GCVE 配置 HCX ServiceMesh"]
* link:https://youtu.be/zQSGq4STX1s["將帶有 HCX 的虛擬機器遷移到 GCVE"]


====
.來自 VMware
[%collapsible%open]
====
* link:https://youtu.be/EFE5ZYFit3M["適用於 GCVE 的 HCX 連接器部署"]
* link:https://youtu.be/uwRFFqbezIE["GCVE 的 HCX ServiceMesh 配置"]
* link:https://youtu.be/4KqL0Rxa3kM["HCX 工作負載遷移至 GCVE"]


====


== 在哪裡可以找到更多信息

要了解有關本文檔中描述的信息的更多信息，請參閱以下網站連結：

* Google Cloud VMware Engine 文件
+
https://cloud.google.com/vmware-engine/docs/overview/["https://cloud.google.com/vmware-engine/docs/overview"^]

* Cloud Volume Service 文檔
+
https://cloud.google.com/architecture/partners/netapp-cloud-volumes["https://cloud.google.com/architecture/partners/netapp-cloud-volumes"^]

* VMware HCX 使用者指南
+
https://docs.vmware.com/en/VMware-HCX/index.html["https://docs.vmware.com/en/VMware-HCX/index.html"^]


