---
sidebar: sidebar 
permalink: vmware/vmw-gcp-gcve-app-dr-ds-veeam.html 
keywords: gcp, gcve, snapcenter, cvo, gcnv, iscsi, guest connect, dr, disaster recovery 
summary: 雲端災難復原是一種具有彈性且經濟高效的方法，可保護工作負載免受網站中斷和勒索軟體等資料損壞事件的影響。透過NetApp SnapMirror，使用來賓連接儲存的本機 VMware 工作負載可以複製到在 Google Cloud 中執行的NetApp Cloud Volumes ONTAP 。 
---
= 使用NetApp SnapCenter和 Veeam Replication 實現應用程式一致性災難復原
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
雲端災難復原是一種具有彈性且經濟高效的方法，可保護工作負載免受網站中斷和勒索軟體等資料損壞事件的影響。透過NetApp SnapMirror，使用來賓連接儲存的本機 VMware 工作負載可以複製到在 Google Cloud 中執行的NetApp Cloud Volumes ONTAP 。



== 概況

許多客戶正在為託管在 VMware vSphere 上的應用程式虛擬機器尋找有效的災難復原解決方案。他們中的許多人使用現有的備份解決方案在災難期間進行復原。很多時候，該解決方案會增加 RTO 並且無法滿足他們的期望。為了減少 RPO 和 RTO，只要有網路連線和具有適當權限的環境，就可以利用 Veeam VM 複製，甚至可以從本地到 GCVE。注意：Veeam VM Replication 不會保護 VM 用戶機連接的儲存設備，例如客戶機 VM 內的 iSCSI 或 NFS 掛載。需要單獨保護它們。

為了實現 SQL VM 的應用程式一致性複製並減少 RTO，我們使用SnapCenter來協調 SQL 資料庫和日誌磁碟區的 SnapMirror 操作。

本文檔提供了使用NetApp SnapMirror、Veeam 和 Google Cloud VMware Engine (GCVE) 設定和執行災難復原的逐步方法。

image:dr-cvs-gcve-veeam-001.png["應用程式虛擬機器複製架構"]



== 假設

本文檔重點介紹應用程式資料的客戶機內儲存（也稱為客戶機連線），我們假設本機環境使用SnapCenter進行應用程式一致性備份。


NOTE: 本文檔適用於任何第三方備份或復原解決方案。根據環境中使用的解決方案，遵循最佳實務來建立符合組織 SLA 的備份策略。

對於本地環境和 Google Cloud 網路之間的連接，請使用專用互連或 Cloud VPN 等連接選項。應根據內部部署 VLAN 設計來建立段。


NOTE: 將本機資料中心連接到 Google Cloud 有多種選擇，因此我們無法在本文檔中概述特定的工作流程。請參閱 Google Cloud 文檔，以了解適當的本地到 Google 連接方法。



== 部署災難復原解決方案



=== 解決方案部署概述

. 確保使用SnapCenter備份應用程式資料並滿足必要的 RPO 要求。
. 在適當的訂閱和虛擬網路中，使用BlueXP為Cloud Volumes ONTAP配置正確的實例大小。
+
.. 為相關應用程式磁碟區設定SnapMirror 。
.. 更新SnapCenter中的備份策略以在排程的作業之後觸發SnapMirror更新。


. 安裝 Veeam 軟體並開始將虛擬機器複製到 Google Cloud VMware Engine 執行個體。
. 在災難事件期間，使用BlueXP中斷SnapMirror關係並使用 Veeam 觸發虛擬機器故障轉移。
+
.. 重新連接應用程式虛擬機器的 ISCSI LUN 和 NFS 掛載。
.. 在網路上啟動應用程式。


. 主站點恢復後，透過反向重新同步SnapMirror呼叫故障回復到受保護站點。




=== 部署詳情

.在 Google Cloud 上設定 CVO 並將磁碟區複製到 CVO
[%collapsible%open]
====
第一步是在 Google Cloud 上設定Cloud Volumes ONTAP （link:vmw-gcp-gcve-guest-storage.html["克沃"^] ) 並以所需的頻率和快照保留將所需的磁碟區複製到Cloud Volumes ONTAP 。

image:dr-cvo-gcve-002.png["此圖顯示輸入/輸出對話框或表示書面內容"]

有關設定SnapCenter和複製資料的範例逐步說明，請參閱link:vmw-aws-vmc-guest-storage-dr.html#config-snapmirror["使用SnapCenter設定複製"]

.使用SnapCenter審查 SQL VM 保護
video::395e33db-0d63-4e48-8898-b01200f006ca[panopto]
====
.配置 GCVE 主機和 CVO 資料存取
[%collapsible%open]
====
部署 SDDC 時需要考慮的兩個重要因素是 GCVE 解決方案中 SDDC 叢集的大小以及保持 SDDC 服務的時間。災難復原解決方案的這兩個關鍵考慮因素有助於降低整體營運成本。  SDDC 最小可以只有三台主機，最大可以達到全面部署的多主機叢集。

Google Cloud NetApp Volumes for NFS 資料儲存區和Cloud Volumes ONTAP for SQL 資料庫和日誌可以部署到任何 VPC，並且 GCVE 應該具有與該 VPC 的私有連接以掛載 NFS 資料儲存區並讓 VM 連接到 iSCSI LUN。

若要設定 GCVE SDDC，請參閱link:vmw-gcp-gcve-setup.html["在 Google Cloud Platform (GCP) 上部署和配置虛擬化環境"^]。作為先決條件，請驗證在建立連線後，駐留在 GCVE 主機上的客戶虛擬機器是否能夠使用來自Cloud Volumes ONTAP的資料。

正確配置Cloud Volumes ONTAP和 GCVE 後，開始設定 Veeam，使用 Veeam 複製功能自動將本機工作負載恢復到 GCVE（具有應用程式 VMDK 的虛擬機器和具有來賓內儲存的虛擬機器），並利用SnapMirror將應用程式磁碟區複製到Cloud Volumes ONTAP。

====
.安裝 Veeam 組件
[%collapsible%open]
====
根據部署場景，需要部署Veeam備份伺服器、備份儲存庫和備份代理程式。對於這種用例，不需要為 Veeam 部署物件存儲，也不需要 Scale-out 儲存庫。https://helpcenter.veeam.com/docs/backup/vsphere/replication_components.html?ver=120["有關安裝過程，請參閱 Veeam 文檔"]欲了解更多信息，請參閱link:vmw-gcp-gcve-migrate-veeam.html["使用 Veeam Replication 進行遷移"]

====
.使用 Veeam 設定虛擬機器複製
[%collapsible%open]
====
本機 vCenter 和 GCVE vCenter 都需要在 Veeam 中註冊。 https://helpcenter.veeam.com/docs/backup/vsphere/replica_job.html?ver=120["設定 vSphere VM 複製作業"]在精靈的客戶機處理步驟中，選擇停用應用程式處理，因為我們將利用SnapCenter進行應用程式感知備份和復原。

video::8b7e4a9b-7de1-4d48-a8e2-b01200f00692[panopto,width=360]
====
.Microsoft SQL Server VM 的故障轉移
[%collapsible%open]
====
video::9762dc99-081b-41a2-ac68-b01200f00ac0[panopto,width=360]
====


== 此解決方案的優勢

* 使用SnapMirror的高效且有彈性的複製。
* 透過ONTAP快照保留還原到任何可用的時間點。
* 從儲存、運算、網路和應用程式驗證步驟，恢復數百到數千台虛擬機器所需的所有步驟均可完全自動化。
* SnapCenter使用不會改變複製磁碟區的克隆機制。
+
** 這避免了磁碟區和快照資料損壞的風險。
** 避免 DR 測試工作流程期間的複製中斷。
** 利用 DR 資料進行 DR 以外的工作流程，例如開發/測試、安全測試、修補程式和升級測試以及補救測試。


* Veeam Replication 允許在 DR 站點上變更 VM IP 位址。

