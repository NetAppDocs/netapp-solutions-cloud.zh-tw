---
sidebar: sidebar 
permalink: openshift/os-dp-velero-backup.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift, OADP operator, Openshift Data Protection Application operator, Velero 
summary: Red Hat OpenShift 容器應用程式資料保護與NetApp ONTAP 
---
= 在 OpenShift Container Platform 中為應用程式建立按需備份
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
本節概述如何在 OpenShift Virtualization 中為虛擬機器建立按需備份。



== 建立應用程式備份的步驟

若要建立應用程式的隨選備份（應用程式元資料和應用程式的持久性磁碟區），請按一下**備份**標籤以建立備份自訂資源（CR）。提供了一個範例 yaml 來建立備份 CR。使用此 yaml，將備份指定命名空間中的應用程式及其持久性儲存。可以設定其他參數，如下所示link:https://docs.openshift.com/container-platform/4.14/backup_and_restore/application_backup_and_restore/backing_up_and_restoring/oadp-creating-backup-cr.html["文件"]。

CSI 將建立指定命名空間中的持久磁碟區和應用程式資源的快照。此快照將儲存在 yaml 中指定的備份位置。備份將按照 ttl 的規定在系統中保留 30 天。

....
spec:
  csiSnapshotTimeout: 10m0s
  defaultVolumesToFsBackup: false
  includedNamespaces:
    - postgresql ->namespace of the app
  itemOperationTimeout: 4h0m0s
  snapshotMoveData: false
  storageLocation: velero-container-backup-ontap-1 -->this is the backupStorageLocation previously created when Velero is configured.
  ttl: 720h0m0s
....
備份完成後，其階段將顯示為已完成。

image:redhat-openshift-oadp-backup-001.png["備份完成"]

您可以使用 S3 瀏覽器應用程式檢查物件儲存中的備份。備份路徑顯示在配置的儲存桶中，前綴名稱為（velero/container-demo-backup）。您可以看到備份的內容包括磁碟區快照、日誌和應用程式的其他元資料。


NOTE: 在 StorageGrid 中，您也可以使用租用戶管理器提供的 S3 控制台來檢視備份物件。

image:redhat-openshift-oadp-backup-002.png["S3 中的備份對象"]



== 為應用程式建立排程備份

若要按排程建立備份，您需要建立計劃 CR。該計劃只是一個 Cron 表達式，可讓您指定要建立備份的時間。下面顯示了建立 Schedule CR 的範例 yaml。

....
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: schedule1
  namespace: openshift-adp
spec:
  schedule: 0 7 * * *
  template:
    includedNamespaces:
      - postgresql
    storageLocation: velero-container-backup-ontap-1
....
Cron表達式 0 7 * * * 表示每天7:00建立備份。也指定了要包含在備份中的命名空間和備份的儲存位置。因此，不是使用備份 CR，而是使用計劃 CR 在指定的時間和頻率建立備份。

一旦創建了計劃，它將被啟用。

image:redhat-openshift-oadp-backup-003.png["已建立時間表"]

備份將根據此計劃創建，並可從「備份」標籤中查看。

image:redhat-openshift-oadp-backup-004.png["計劃備份已完成"]
