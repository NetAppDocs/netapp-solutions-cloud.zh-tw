---
sidebar: sidebar 
permalink: openshift/os-sm-setup.html 
keywords: NetApp Solutions, redhat OpenShift, red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMware, customer managed storage, ONTAP 
summary:  
---
= 在 AWS 上部署和設定 Red Hat OpenShift Container 平台
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
本節介紹如何在 AWS 中設定和管理 OpenShift 叢集並在其上部署有狀態應用程式的進階工作流程。它展示瞭如何使用NetApp Cloud Volumes ONTAP儲存在Trident的幫助下提供持久卷。提供了有關使用Trident Protect 為有狀態應用程式執行資料保護和遷移活動的詳細資訊。


NOTE: 有幾種方法可以在 AWS 上部署 Red Hat OpenShift Container 平台叢集。此設定的高級描述提供了所使用的特定方法的文檔連結。您可以參考link:os-solutions-resources.html["資源部分"]。

下圖描述了部署在 AWS 上並使用 VPN 連接到資料中心的叢集。

image:rhhc-self-managed-aws.png["此圖顯示輸入/輸出對話框或表示書面內容"]

設定過程可分為以下步驟：

.從進階叢集管理在 AWS 上安裝 OCP 叢集。
[%collapsible%open]
====
* 建立具有網站到網站 VPN 連線（使用 pfSense）的 VPC 以連接到本機網路。
* 內部網路具有網路連線。
* 在 3 個不同的 AZ 中建立 3 個私有子網路。
* 為 VPC 建立 Route 53 私人託管區域和 DNS 解析器。


從進階叢集管理 (ACM) 精靈在 AWS 上建立 OpenShift 叢集。參考說明link:https://docs.openshift.com/dedicated/osd_install_access_delete_cluster/creating-an-aws-cluster.html["這裡"]。


NOTE: 您也可以從 OpenShift 混合雲控制台在 AWS 中建立叢集。參考link:https://docs.openshift.com/container-platform/4.10/installing/installing_aws/installing-aws-default.html["這裡"]以取得說明。


TIP: 使用 ACM 建立叢集時，您可以在表單檢視中填寫詳細資料後透過編輯 yaml 檔案來自訂安裝。叢集建立完成後，可以透過ssh登入叢集的節點進行故障排除或額外的手動設定。使用您在安裝過程中提供的 ssh 金鑰和使用者名稱 core 登入。

====
.使用BlueXP在 AWS 中部署Cloud Volumes ONTAP 。
[%collapsible%open]
====
* 在本機 VMware 環境中安裝連接器。參考說明link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-install-connector-on-prem.html#install-the-connector["這裡"]。
* 使用連接器在 AWS 中部署 CVO 執行個體。參考說明link:https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-getting-started-aws.html["這裡"]。



NOTE: 此連接器也可以安裝在雲端環境中。參考link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-connectors.html["這裡"]了解更多。

====
.在 OCP 叢集中安裝Trident
[%collapsible%open]
====
* 使用 Helm 部署Trident Operator。參考說明link:https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy-helm.html["這裡"]
* 建立後端和儲存類別。參考說明link:https://docs.netapp.com/us-en/trident/trident-use/backends.html["這裡"]。


====
.使用Trident的 CSI 拓樸功能實現多區域架構
如今，雲端提供者使 Kubernetes/OpenShift 叢集管理員能夠產生基於區域的叢集節點。節點可以位於一個區域內的不同可用區，也可以跨越多個區域。為了方便在多區域架構中為工作負載配置卷， Trident使用了 CSI 拓撲。使用 CSI 拓撲功能，可以根據區域和可用區域將對磁碟區的存取限製到節點子集。參考link:https://docs.netapp.com/us-en/trident/trident-use/csi-topology.html["這裡"]了解更多詳細資訊。


NOTE: Kubernetes 支援兩種磁碟區綁定模式： - 當 **_VolumeBindingMode_ 設定為 _Immediate_**（預設）時， Trident會在沒有任何拓樸感知的情況下建立磁碟區。持久性卷的建立不依賴請求 pod 的調度要求。 - 當 **_VolumeBindingMode_ 設定為 _WaitForFirstConsumer_** 時，PVC 的持久卷的建立和綁定將被延遲，直到使用該 PVC 的 pod 被調度和建立。這樣，就可以建立磁碟區來滿足拓樸要求所強制執行的調度約束。 Trident儲存後端可設計為根據可用區域（拓撲感知後端）選擇性地配置磁碟區。對於使用此類後端的 StorageClasses，只有在受支援的區域/區域中調度的應用程式請求時才會建立磁碟區。  （拓樸感知 StorageClass）參考link:https://docs.netapp.com/us-en/trident/trident-use/csi-topology.html["這裡"]了解更多詳細資訊。
