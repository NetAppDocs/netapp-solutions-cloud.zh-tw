---
sidebar: sidebar 
permalink: openshift/os-pm-setup.html 
keywords: NetApp Solutions, redhat OpenShift, red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMware, customer managed storage, ONTAP, ROSA, ROSA clusters 
summary:  
---
= 在 AWS 上部署和設定託管 Red Hat OpenShift 容器平台
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
本節介紹在 AWS（ROSA）上設定託管 Red Hat OpenShift 叢集的進階工作流程。它展示了Trident使用託管的Amazon FSx for NetApp ONTAP (FSx ONTAP ) 作為儲存後端來提供持久性磁碟區。提供了有關使用BlueXP在 AWS 上部署 FSx ONTAP的詳細資訊。此外，還提供了有關使用BlueXP和 OpenShift GitOps（Argo CD）為 ROSA 叢集上的有狀態應用程式執行資料保護和遷移活動的詳細資訊。

下圖描述了部署在 AWS 上並使用 FSx ONTAP作為後端儲存的 ROSA 叢集。

image:rhhc-rosa-with-fsxn.png["此圖顯示輸入/輸出對話框或表示書面內容"]


NOTE: 該解決方案透過在AWS的兩個VPC中使用兩個ROSA集群進行了驗證。每個 ROSA 叢集都使用Trident與 FSx ONTAP整合。在 AWS 中部署 ROSA 叢集和 FSx ONTAP有幾種方法。此設定的高級描述提供了所使用的特定方法的文檔連結。您可以參考link:os-solutions-resources.html["資源部分"]。

設定過程可分為以下步驟：

.安裝ROSA集群
* 建立兩個 VPC 並在 VPC 之間建立 VPC 對等連線。
* 參考link:https://docs.openshift.com/rosa/welcome/index.html["這裡"]有關安裝 ROSA 集群的說明。


.安裝 FSx ONTAP
* 從BlueXP在 VPC 上安裝 FSx ONTAP 。參考link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.html["這裡"]用於建立BlueXP帳戶並開始使用。參考link:https://docs.netapp.com/us-en/cloud-manager-fsx-ontap/index.html["這裡"]用於安裝 FSx ONTAP。參考link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.html["這裡"]用於在 AWS 中建立連接器來管理 FSx ONTAP。
* 使用 AWS 部署 FSx ONTAP 。參考link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/getting-started-step1.html["這裡"]使用 AWS 控制台進行部署。


.在 ROSA 叢集上安裝Trident （使用 Helm 圖表）
* 使用 Helm chart 在 ROSA 叢集上安裝Trident 。請參閱文件連結： https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy-helm.html [此處]。


.FSx ONTAP與Trident整合用於 ROSA 集群
video::621ae20d-7567-4bbf-809d-b01200fa7a68[panopto]

NOTE: OpenShift GitOps 可用於將Trident CSI 部署到所有託管集群，因為它們使用 ApplicationSet 註冊到 ArgoCD。

image:rhhc-trident-helm.png["此圖顯示輸入/輸出對話框或表示書面內容"]

.使用Trident建立後端和儲存類別（適用於 FSx ONTAP）
* 參考link:https://docs.netapp.com/us-en/trident/trident-use/backends.html["這裡"]有關建立後端和儲存類別的詳細資訊。
* 從 OpenShift 控制台將使用Trident CSI 為 FsxN 建立的儲存類別設為預設。請參閱下面的截圖：


image:rhhc-default-storage-class.png["此圖顯示輸入/輸出對話框或表示書面內容"]

.使用 OpenShift GitOps（Argo CD）部署應用程式
* 在叢集上安裝 OpenShift GitOps 操作員。參考說明link:https://docs.openshift.com/container-platform/4.10/cicd/gitops/installing-openshift-gitops.html["這裡"]。
* 為叢集設定一個新的 Argo CD 實例。參考說明link:https://docs.openshift.com/container-platform/4.10/cicd/gitops/setting-up-argocd-instance.html["這裡"]。


打開Argo CD的控制台並部署一個應用程式。例如，您可以使用帶有 Helm Chart 的 Argo CD 部署 Jenkins 應用程式。建立應用程式時，提供了以下詳細資訊：專案：預設叢集：'https://kubernetes.default.svc'[] （不含引號）命名空間：Jenkins Helm Chart 的 URL：'https://charts.bitnami.com/bitnami'[] （不含引號）

Helm 參數：global.storageClass: fsxn-nas
